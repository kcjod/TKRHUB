<%- include('./partials/header') %>

  <div class="w-[80%] relative top-16 flex flex-col justify-center items-center mx-auto">
    <div>
      <h1 class=" text-center md:text-2xl lg:text-2xl xl:text-3xl text-[20px]">
        Have you ever gone through an interview?
      </h1>
    </div>
    <div class="flex items-center gap-2 w-full justify-center mt-2">
      <img src="../images/<%= user.profileimg %>" alt=""
        class="h-[40px] rounded-full border-2 border-zinc-200 lg:block" />
      <div class="w-[100%] h-[40px] bg-gray-100 my-2 px-8 py-2 rounded-3xl md:w-[50%] lg:w-[35%] cursor-pointer"
        id="dropdownButton">
        Start a post
      </div>

      <div class="hidden fixed inset-0 bg-black opacity-50 z-50" id="modalBackdrop"></div>

      <!-- Dropdown form -->
      <div
        class="hidden bg-yellow-200 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded-md shadow-md z-50"
        id="dropdownForm">
        <form class="flex flex-col items-center" action="/post" method="post">
          <textarea
            class="w-[80vw] h-[60vh] resize-none border border-gray-300 rounded-md p-2 focus:outline-none focus:ring focus:ring-yellow-400"
            name="content" placeholder="Share your experience"></textarea>
          <input type="submit" value="Post"
            class="cursor-pointer w-[30vw] mt-2 bg-yellow-300 md:w-[15vw] lg:w-[5vw] hover:bg-yellow-400 text-white font-bold py-2 px-4 rounded" />
        </form>
      </div>
    </div>
  </div>

  <!-- Feed cards -->
  <div id="feed-container"
    class="w-[90%] relative top-16 flex flex-col gap-5 justify-center items-center mx-auto mt-2 lg:w-[80%]">
    <% posts.forEach(function(post){ %>
      <div class="card border-b-4 border-slate-700 w-[100%] text-sm md:text-base rounded-xl bg-zinc-100 shadow-lg flex flex-col px-3 py-2 my-2 md:w-[100%]">
        <div class="dets flex gap-2 relative items-center">
          <img src="../images/<%= post.author.profileimg %>" alt="" class="h-[40px] rounded-full" />
          <div class="font-semibold">
            <%= post.author.username %>
          </div>
          <div class="font-zinc-400">
            <%= post.author.followers.length %> followers
          </div>
          <a href="/follow/:username"><button
              class="bg-yellow-400 opacity-85 px-3 py-2 rounded-2xl text-white hover:opacity-100">
              Follow
            </button></a>
        </div>
        <div class="hero flex flex-col items-start justify-center mt-2">
          <div class="content text-start break-normal" id="content">
            <!-- Initial content with limited characters -->
            <pre id="content" class="whitespace-pre-wrap"><%= post.Truncatedcontent %></pre>
            <!-- Full content (hidden by default) -->
            <pre id="full-content" class="hidden whitespace-pre-wrap"><%= post.content %></pre>
          </div>
          <span id="read-more-btn" class="cursor-pointer  mx-auto flex text-blue-500 hover:underline">
            Read More
          </span>
          <span id="read-less-btn" class="cursor-pointer mx-auto hidden text-blue-500 hover:underline">
            Read Less
          </span>
          <div class="btns flex h-[20px] mx-auto justify-center items-center gap-5 my-2">
            <!-- icons -->
            <div class="cursor-pointer">
              <i class="ri-thumb-up-line"></i>
              <span class="text-zinc-600">
                <%= post.likes.length %>
              </span>
            </div>
            <div class="cursor-pointer">
              <i class="ri-chat-3-line"></i>
              <span class="text-zinc-600">
                <%= post.comments.length %>
              </span>
            </div>
            <div class="cursor-pointer">
              <i class="ri-share-line"></i>
            </div>
          </div>
        </div>

      </div>

      <% }) %>
  </div>

  <script>

    // read more and less functionality
    document.addEventListener("DOMContentLoaded", function () {
      const readMoreBtns = document.querySelectorAll("#read-more-btn");
      const readLessBtns = document.querySelectorAll("#read-less-btn");
      const contents = document.querySelectorAll("#content");
      const fullContents = document.querySelectorAll("#full-content");

      readMoreBtns.forEach((readMoreBtn, index) => {
        readMoreBtn.addEventListener("click", function () {
          contents[index].innerText = fullContents[index].innerText;
          readMoreBtn.classList.add("hidden");
          readLessBtns[index].classList.remove("hidden");
        });
      });

      readLessBtns.forEach((readLessBtn, index) => {
        readLessBtn.addEventListener("click", function () {
          console.log('readless');
          contents[index].innerText = fullContents[index].innerText.slice(0, 150) + "...";
          readMoreBtns[index].classList.remove("hidden");
          readLessBtn.classList.add("hidden");
        });
      });
    });


    // Get the button, modal backdrop, and dropdown form
    var button = document.getElementById("dropdownButton");
    var modalBackdrop = document.getElementById("modalBackdrop");
    var dropdownForm = document.getElementById("dropdownForm");

    // Show the modal and backdrop when the button is clicked
    button.addEventListener("click", function () {
      modalBackdrop.classList.remove("hidden");
      dropdownForm.classList.remove("hidden");
    });

    // Hide the modal and backdrop when clicking outside the form
    modalBackdrop.addEventListener("click", function () {
      modalBackdrop.classList.add("hidden");
      dropdownForm.classList.add("hidden");
    });


  </script>

  <%- include('./partials/footer') %>